const { sumTokensExport, sumTokens2 } = require('../helper/unwrapLPs')
const ADDRESSES = require('../helper/coreAssets.json')

const config = {
  ethereum: {
    // https://docs.reservoir.xyz/products/proof-of-reserves
    funds: [
      '0x0c7e4342534e6e8783311dCF17828a2aa0951CC7',
      '0x9BB2c38F57883E5285b7c296c66B9eEA4769eF80',
      '0x99A95a9E38e927486fC878f41Ff8b118Eb632b10', // steakUSDC
      '0xE45321525c85fcc418C88E606B96daD8cBcc047f',
      // '0x841DB2cA7E8A8C2fb06128e8c58AA162de0CfCbC',  // duplicated in tokensAndOwners
      '0x99E8903bdEFB9e44cd6A24B7f6F97dDd071549bc', // USUALUSDC+
      // '0x2Adf038b67a8a29cDA82f0Eceb1fF0dba704b98d',  // duplicated in tokensAndOwners
      '0xb82749F316CB9c06F38587aBecF3EB1bC842CC93', // bbqUSDCreservoir
      '0xC5deA68CCe26c014BEC516CDA70c107c534a73C4', // bbqUSDC - Steakhouse High Yield Instant
      // '0x31Eae643b679A84b37E3d0B4Bd4f5dA90fB04a61', - exluded RUSD because it is project's own token
    ],
    // [token, owner] pairs for direct balance queries
    tokensAndOwners: [
      ['0xe0a80d35bb6618cba260120b279d357978c42bce', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // eUSDC-22
      ['0x797DD80692c3b2dAdabCe8e30C07fDE5307D48a9', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // eUSDC-2
      ['0x6DFC8ae855FA8Ab7bAbB81aB7c8a6DA7794f60fB', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // erUSD-1
      ['0xFa82580c16A31D0c1bC632A36F82e83EfEF3Eec0', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // aEthRLUSD
      ['0x0C0d01AbF3e6aDfcA0989eBbA9d6e85dD58EaB1E', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // aEthPYUSD
      ['0xaF5372792a29dC6b296d6FFD4AA3386aff8f9BB2', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // eRLUSD-7
      ['0xba98fc35c9dfd69178ad5dce9fa29c64554783b5', '0x3063C5907FAa10c01B242181Aa689bEb23D2BD65'], // ePYUSD-6
      [ADDRESSES.ethereum.sUSDe, '0x5563CDA70F7aA8b6C00C52CB3B9f0f45831a22b1'], // sUSDe
      ['0x9D39A5DE30e57443BfF2A8307A4256c8797A3497', '0x5563CDA70F7aA8b6C00C52CB3B9f0f45831a22b1'], // sUSDe
      ['0x1fb3c5c35d95f48e48ffc8e36bcce5cb5f29f57c', '0x5563CDA70F7aA8b6C00C52CB3B9f0f45831a22b1'], // PT-srUSDe-15JAN2026
      // ['0xBeEf11eCb698f4B5378685C05A210bdF71093521', '0x31Eae643b679A84b37E3d0B4Bd4f5dA90fB04a61'], // wrapped version of RUSD, excluded steakRUSD
      ['0xBEeFFF209270748ddd194831b3fa287a5386f5bC', '0x841DB2cA7E8A8C2fb06128e8c58AA162de0CfCbC'], // bbqUSDC
      ['0xA0804346780b4c2e3bE118ac957D1DB82F9d7484', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // bbqUSDT
      ['0x5C20B550819128074FD538Edf79791733ccEdd18', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // fUSDT
      ['0x9Fb7b4477576Fe5B32be4C1843aFB1e55F251B33', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // fUSDC
      ['0xc197ad72936b7c558c96417f22041fe9e3c7043f', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // ResHY
      ['0xdd0f28e19C1780eb6396170735D45153D261490d', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // gtUSDC
      ['0x777791C4d6DC2CE140D00D2828a7C93503c67777', '0x2adf038b67a8a29cda82f0eceb1ff0dba704b98d'], // hyperUSDC
      ['0x1135b22d6e8FD0809392478eEDcd8c107dB6aF9D', '0x8d3A354f187065e0D4cEcE0C3a5886ac4eBc4903'], // PT-tUSDe-18DEC2025
      ['0x4c9EDD5852cd905f086C759E8383e09bff1E68B3', '0x8d3A354f187065e0D4cEcE0C3a5886ac4eBc4903'], // USDe
      ['0xA01227A26A7710bc75071286539E47AdB6DEa417', '0x8d3A354f187065e0D4cEcE0C3a5886ac4eBc4903'], // tUSDe
      ['0x62C6E813b9589C3631Ba0Cdb013acdB8544038B7', '0x8d3A354f187065e0D4cEcE0C3a5886ac4eBc4903'], // PT-tUSDe-18DEC2025 (alt)
      [ADDRESSES.ethereum.USDC, '0x4809010926aec940b550D34a46A52739f996D75D'], // USDC
      ['0xf63bdb49Ab15eb8F85d5e200D4fa9E242cc4e853', '0x8Cc5a546408C6cE3C9eeB99788F9EC3b8FA6b9F3'], // Pendle-rUSD LP token
      ['0xA00f596e9D03fe90c5d22C15B468e8Dce4d24dE0', '0x8Cc5a546408C6cE3C9eeB99788F9EC3b8FA6b9F3'], // Pendle-rUSD market
      ['0x77B50ef8D55b8d6F9a632468e417bE21d5712A2E', '0x8Cc5a546408C6cE3C9eeB99788F9EC3b8FA6b9F3'], // Pendle-wsrUSD LP token
      ['0x41b5236DF40C4718A76d4342e83153556373C072', '0x8Cc5a546408C6cE3C9eeB99788F9EC3b8FA6b9F3'], // Pendle-wsrUSD market
      ['0x545A490f9ab534AdF409A2E682bc4098f49952e3', '0x8Cc5a546408C6cE3C9eeB99788F9EC3b8FA6b9F3'], // PT-cUSD-29JAN2026
      ['0xC3c7E5E277d31CD24a3Ac4cC9af3B6770F30eA33', '0x8Cc5a546408C6cE3C9eeB99788F9EC3b8FA6b9F3'], // PT Staked cap USD 29JAN2026
      ['0x5DaAee9EF143faFF495B581e9863570e83F99d31', '0xE94fc572b5E5Abe38F326F7DeDfe4f0Df9851d2A'], // S*USDC Ethereum
      ['0x17BBC9BD51a52aAf4d2CC6652630DaF4fdB358F7', '0xE94fc572b5E5Abe38F326F7DeDfe4f0Df9851d2A'], // S*USDT Ethereum
      ['0xdC035D45d973E3EC169d2276DDab16f1e407384F', '0x0b578e123e3725a15F6FCbd43ADf314EaA667c04'], // USDS
    ],
  },
  plasma: {
    tokensAndOwners: [
      ['0x7519403E12111ff6b710877Fcd821D0c12CAF43A', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // aPlaUSDe
      ['0xa9C251F8304b1B3Fc2b9e8fcae78D94Eff82Ac66', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], 
      ['0x1DD4b13fcAE900C60a350589BE8052959D2Ed27B', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // fUSDT0
      ['0x5D72a9d9A9510Cd8cBdBA12aC62593A58930a948', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // aPlaUSDT0
      ['0xB8CE59FC3717ada4C02eaDF9682A9e934F625ebb', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // USDT0
      ['0x5d3a1Ff2b6BAb83b63cd9AD0787074081a52ef34', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // USDe
      ['0xe818ad0D20D504C55601b9d5e0E137314414dec4', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // k3USDT
      ['0xd8f824d4252caE7d5E49B95d47B0EfAfe6f2d570', '0x9A319b57B80c50f8B19DB35D3224655F3aDd8E4f'], // fUSDe
    ]
  },
  arbitrum: {
    tokensAndOwners: [
      ['0x5c0C306Aaa9F877de636f4d5822cA9F2E81563BA', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // bbqUSDC
      ['0x7e97fa6893871A2751B5fE961978DCCb2c201E65', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // gtUSDCc
      ['0x1A996cb54bb95462040408C06122D45D6Cdb6096', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // fUSDC
      ['0x6Ea313859A5D9F6fF2a68f529e6361174bFD2225', '0xE94fc572b5E5Abe38F326F7DeDfe4f0Df9851d2A'], // S*USDC Arb
      ['0x8D66Ff1845b1baCC6E87D867CA4680d05A349cA8', '0xE94fc572b5E5Abe38F326F7DeDfe4f0Df9851d2A'], // S*USDT Arb
    ]
  },
  base: {
    tokensAndOwners: [
      ['0xBEEFE94c8aD530842bfE7d8B397938fFc1cb83b2', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // steakUSDC
      ['0xeE8F4eC5672F09119b96Ab6fB59C27E1b7e44b61', '0x289C204B35859bFb924B9C0759A4FE80f610671c'], // gtUSDCp
    ]
  },
  berachain: {
    tokensAndOwners: [
      ['0x549943e04f40284185054145c6E4e9568C1D3241', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // USDC.e
      ['0xFCBD14DC51f0A4d49d5E53C2E0950e0bC26d0Dce', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // HONEY
      ['0x551FB0309dd7E1C6E1A59d9389ef10dA864a552e', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // USDe
      ['0xdE04c469Ad658163e2a5E860a03A86B52f6FA8C8', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // BYUSD-HONEY-STABLE
      ['0x7fd165B73775884a38AA8f2B384A53A3Ca7400E6', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // KODI rUSD-HONEY
      ['0x1fb6c1aDE4F9083b2EA42ED3fa9342e41788D4b5', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // KODI rUSD-USDâ‚®0
      ['0x688e72142674041f8f6Af4c808a4045cA1D6aC82', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // BYUSD
      ['0x30BbA9CD9Eb8c95824aa42Faa1Bb397b07545bc1', '0x0db79c0770E1C647b8Bb76D94C22420fAA7Ac181'], // Re7HONEY
    ]
  },
  wc: {
    tokensAndOwners: [
      ['0x79A02482A880bCE3F13e09Da970dC34db4CD24d1', '0x6A506576D9d08e93f1E9051F0A164F67a48DdAF2'], // USDC
      ['0xb1E80387EbE53Ff75a89736097D34dC8D9E9045B', '0x6A506576D9d08e93f1E9051F0A164F67a48DdAF2'], // Re7USDC
    ]
  },
  optimism: {
    tokensAndOwners: [
      ['0x8D66Ff1845b1baCC6E87D867CA4680d05A349cA8', '0xE94fc572b5E5Abe38F326F7DeDfe4f0Df9851d2A'], // S*USDC OP
    ]
  },
  plume: {
    tokensAndOwners: [
      ['0xc0Df5784f28046D11813356919B869dDA5815B16', '0x98Cb8fD0D8b6bf104Fa2B5BAB91fd4B0fcC43A47'], // Re7pUSD
    ]
  }
}

module.exports.ethereum = {
  tvl: async (api) => {
    const { funds, tokensAndOwners, } = config.ethereum

    // Get underlying tokens and balances from funds
    const tokens = await api.multiCall({ abi: 'address:underlying', calls: funds })
    const bals = await api.multiCall({ abi: 'uint256:totalValue', calls: funds })
    const decimals = await api.multiCall({ abi: 'uint8:decimals', calls: tokens })

    // Adjust balances and add
    api.add(tokens, bals.map((v, i) => v * 10 ** (decimals[i] - 18)))

    // Add regular token balances
    await api.sumTokens({ tokensAndOwners })
  }
}

module.exports.plasma = { tvl: sumTokensExport(config.plasma) }
module.exports.arbitrum = { tvl: sumTokensExport(config.arbitrum) }
module.exports.base = {
  tvl: async (api) => {
    await api.sumTokens({ tokensAndOwners: config.base.tokensAndOwners })
  }
}
module.exports.berachain = { tvl: sumTokensExport(config.berachain) }
module.exports.wc = { tvl: sumTokensExport(config.wc) }
module.exports.optimism = { tvl: sumTokensExport(config.optimism) }
module.exports.plume = { tvl: sumTokensExport(config.plume) }
